services:

  udashboard.context:
    class: MakinaCorpus\Dashboard\Drupal\Context\ContextPane
    arguments: ['@event_dispatcher', '@request_stack']

  udashboard.view_factory:
    class: MakinaCorpus\Dashboard\DependencyInjection\ViewFactory
    arguments: ['@service_container']

  udashboard.processor_registry:
    class: MakinaCorpus\Dashboard\Drupal\Action\ProcessorActionProvider
    tags: [{name: udashboard.action_provider}]

  udashboard.action_provider_registry:
    public: false
    class: MakinaCorpus\Dashboard\Action\ActionRegistry

  # View implementations
  udashboard.view.twig_page:
    public: true
    class: MakinaCorpus\Dashboard\View\Html\TwigView
    arguments: ['@twig', '@event_dispatcher']
    tags: [{name: udashboard.view, id: twig_page}]
  udashboard.view.twig_form_page:
    public: true
    class: MakinaCorpus\Dashboard\View\Html\FormTwigView
    arguments: ['@twig', '@event_dispatcher']
    tags: [{name: udashboard.view, id: twig_form_page}]

  # Action providers
  udashboard.action_provider.node:
    public: false
    class: MakinaCorpus\Dashboard\Drupal\Action\CoreNodeActionProvider
    tags: [{name: udashboard.action_provider}]

  # Twig extensions
  udashboard.twig.action_extension:
    public: false
    class: MakinaCorpus\Dashboard\Twig\ActionExtension
    arguments: ['@udashboard.action_provider_registry']
    tags: [{name: twig.extension}]
  udashboard.twig.page_extension:
    public: false
    class: MakinaCorpus\Dashboard\Twig\PageExtension
    arguments: ['@request_stack', '@property_accessor', '@property_info']
    tags: [{name: twig.extension}]

  # Property info extractors
  udashboard.property_info_extractor.entity:
    public: false
    class: MakinaCorpus\Dashboard\Drupal\PropertyInfo\EntityProperyInfoExtractor
    tags:
      - {name: property_info.list_extractor}
      - {name: property_info.type_extractor}
      - {name: property_info.description_extractor}
      - {name: property_info.access_extractor}

  # Drupal datasources
  udashboard.datasource.drupal_account:
    public: true
    class: MakinaCorpus\Dashboard\Drupal\Datasource\DefaultAccountDatasource
    arguments: ['@database', '@entity.manager']
    tags: [{name: udashboard.datasource}]
  udashboard.datasource.drupal_node:
    public: false
    class: MakinaCorpus\Dashboard\Drupal\Datasource\DefaultNodeDatasource
    arguments: ['@database', '@entity.manager']
    tags: [{name: udashboard.datasource}]

  # Drupal page definitions
  udashboard.page.drupal_account:
    public: true
    class: MakinaCorpus\Dashboard\Drupal\Page\AccountPageDefinition
    tags: [{name: udashboard.page_definition}]
  udashboard.page.drupal_node:
    public: true
    class: MakinaCorpus\Dashboard\Drupal\Page\NodePageDefinition
    arguments: ['@udashboard.datasource.drupal_node']
    tags: [{name: udashboard.page_definition}]

  # Event subscribers
  udashboard.twig_view_event_subscriber:
    class: MakinaCorpus\Dashboard\Drupal\EventDispatcher\ViewEventSubscriber
    tags: [{name: event_subscriber}]
